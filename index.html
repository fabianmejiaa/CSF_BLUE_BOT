<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Asistente Virtual - Voz Completa</title>

<style>
    /* -------------------------------
       ESTILO GENERAL ‚Äì AZUL MODERNO
    ---------------------------------*/
    body {
        margin: 0;
        font-family: "Inter", Arial, sans-serif;
        background: linear-gradient(135deg, #d9eaff, #8bbcff);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        padding: 20px;
    }

    /* CONTENEDOR */
    #chatContainer {
        width: 450px;
        max-width: 100%;
        height: 90vh;
        background: rgba(255, 255, 255, 0.25);
        border-radius: 20px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        backdrop-filter: blur(18px);
        border: 1px solid rgba(255,255,255,0.5);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        position: relative;
    }

    /* BOT√ìN REFRESH */
    #refreshChat {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255,255,255,0.4);
        border: none;
        color: #03426f;
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 12px;
        font-size: 18px;
        transition: 0.2s;
        z-index: 10;
    }

    #refreshChat:hover {
        background: rgba(255,255,255,0.8);
    }

    /* √ÅREA DEL CHAT */
    #chat {
        flex: 1;
        overflow-y: auto;
        padding-right: 10px;
        margin-bottom: 10px;
    }

    /* -------------------------------
        BURBUJAS DE MENSAJE
    ---------------------------------*/
    .msg {
        margin-bottom: 14px;
        padding: 12px 16px;
        border-radius: 14px;
        max-width: 80%;
        line-height: 1.5;
        word-wrap: break-word;
        font-size: 15px;
        backdrop-filter: blur(5px);
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* MENSAJE DEL USUARIO */
    .user {
        background: #0d6efd;
        color: white;
        margin-left: auto;
    }

    /* MENSAJE DEL BOT */
    .bot {
        background: rgba(255,255,255,0.6);
        color: #02375d;
        border: 1px solid rgba(255,255,255,0.7);
        position: relative;
    }

    /* ONDAS DE AUDIO - VISIBLES */
    .audio-waves {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 3px;
        height: 30px;
        margin-top: 10px;
        padding: 5px 0;
    }

    .wave-bar {
        width: 4px;
        background: linear-gradient(to top, #0d6efd, #25d1fd);
        border-radius: 3px;
        animation: wave 1.2s ease-in-out infinite;
    }

    .wave-bar:nth-child(1) { animation-delay: 0.0s; height: 8px; }
    .wave-bar:nth-child(2) { animation-delay: 0.1s; height: 12px; }
    .wave-bar:nth-child(3) { animation-delay: 0.2s; height: 16px; }
    .wave-bar:nth-child(4) { animation-delay: 0.3s; height: 20px; }
    .wave-bar:nth-child(5) { animation-delay: 0.4s; height: 16px; }
    .wave-bar:nth-child(6) { animation-delay: 0.5s; height: 12px; }
    .wave-bar:nth-child(7) { animation-delay: 0.6s; height: 8px; }

    @keyframes wave {
        0%, 100% { transform: scaleY(0.5); }
        50% { transform: scaleY(1.5); }
    }

    /* BOT√ìN DE GRABACI√ìN - VISIBLE */
    #micBtn {
        background: #28a745 !important;
        color: white;
        position: relative;
    }

    #micBtn.recording {
        background: #dc3545 !important;
        animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
        100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }

    /* -------------------------------
        INPUTS Y BOTONES
    ---------------------------------*/
    #inputBox {
        display: flex;
        margin-top: auto;
        gap: 8px;
        align-items: center;
    }

    #messageInput {
        flex: 1;
        padding: 12px 15px;
        border-radius: 14px;
        border: none;
        outline: none;
        font-size: 14px;
        background: rgba(255,255,255,0.5);
        color: #02375d;
        backdrop-filter: blur(6px);
        transition: all 0.3s;
    }

    #messageInput:focus {
        background: rgba(255,255,255,0.8);
        box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.3);
    }

    #messageInput:disabled {
        background: rgba(255,255,255,0.3);
        cursor: not-allowed;
    }

    #sendBtn,
    #micBtn,
    #stopBtn {
        padding: 12px 16px;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        font-size: 14px;
        transition: 0.2s;
        min-width: 60px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #sendBtn {
        background: #0d6efd;
        color: white;
    }

    #sendBtn:hover:not(:disabled) {
        background: #0b5ed7;
    }

    #sendBtn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    #micBtn {
        background: #28a745;
        color: white;
    }

    #micBtn:hover:not(:disabled) {
        background: #218838;
    }

    #micBtn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    #stopBtn {
        background: #dc3545;
        color: white;
        display: none;
    }

    #stopBtn:hover:not(:disabled) {
        background: #c82333;
    }

    /* Loader */
    #loader {
        display: none;
        text-align: center;
        padding: 10px;
        color: #02375d;
        font-style: italic;
    }

    /* Indicador de conexi√≥n */
    #connectionStatus {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 10px;
        background: rgba(0,0,0,0.1);
        color: #02375d;
    }

    /* Scrollbar personalizada */
    #chat::-webkit-scrollbar {
        width: 6px;
    }

    #chat::-webkit-scrollbar-track {
        background: rgba(0,0,0,0.05);
        border-radius: 10px;
    }

    #chat::-webkit-scrollbar-thumb {
        background: rgba(0,0,0,0.2);
        border-radius: 10px;
    }

    #chat::-webkit-scrollbar-thumb:hover {
        background: rgba(0,0,0,0.3);
    }

    /* Notificaci√≥n de permiso */
    #permissionNotification {
        display: none;
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        z-index: 1000;
        text-align: center;
        max-width: 80%;
    }
</style>
</head>

<body>

<div id="permissionNotification">
    ‚ö†Ô∏è Por favor, permite el acceso al micr√≥fono cuando el navegador te lo pida
</div>

<div id="chatContainer">
    <div id="connectionStatus">üü¢ Conectado</div>
    <button id="refreshChat" title="Reiniciar chat">‚Üª</button>
    
    <div id="chat"></div>

    <div id="loader">Procesando...</div>

    <div id="inputBox">
        <input id="messageInput" type="text" placeholder="Escribe tu mensaje aqu√≠..." />
        <button id="sendBtn" title="Enviar mensaje">üì§</button>
        <button id="micBtn" title="Hablar con micr√≥fono">üé§ Hablar</button>
        <button id="stopBtn" title="Detener grabaci√≥n">‚èπÔ∏è Detener</button>
    </div>
</div>

<script>
/* ---------------------------------------------------
    VARIABLES GLOBALES
-----------------------------------------------------*/
const N8N_WEBHOOK_URL = "https://n8n.srv1161635.hstgr.cloud/webhook/6b4f38ff-0de0-49f0-843f-a277a55bdfd5";

let sessionId = localStorage.getItem("sessionId") || crypto.randomUUID();
localStorage.setItem("sessionId", sessionId);

let reconocimiento = null;
let escuchando = false;
let botHablando = false;
let mensajeEnProceso = false;
let audioWavesInterval = null;

// Elementos del DOM
const chatElement = document.getElementById("chat");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const micBtn = document.getElementById("micBtn");
const stopBtn = document.getElementById("stopBtn");
const loader = document.getElementById("loader");
const connectionStatus = document.getElementById("connectionStatus");
const permissionNotification = document.getElementById("permissionNotification");

/* ---------------------------------------------------
    SISTEMA DE VOZ ‚Äì TEXTO A VOZ (CORREGIDO)
-----------------------------------------------------*/
function hablarGratis(texto) {
    if (!texto || botHablando) return;
    
    botHablando = true;
    bloquearEntradaUsuario(true);
    
    // Agregar ondas de audio VISIBLES
    agregarOndasAudio();
    
    // Detener cualquier voz anterior
    speechSynthesis.cancel();
    
    // Dividir texto largo en partes m√°s peque√±as
    const partes = dividirTextoEnPartes(texto, 200);
    let parteIndex = 0;
    
    function hablarParte() {
        if (parteIndex >= partes.length) {
            // Termin√≥ de hablar
            botHablando = false;
            bloquearEntradaUsuario(false);
            removerOndasAudio();
            return;
        }
        
        const parte = partes[parteIndex];
        const voz = new SpeechSynthesisUtterance(parte);
        voz.lang = "es-ES";
        voz.rate = 1.0;
        voz.pitch = 1.0;
        voz.volume = 1.0;
        
        // Configurar voces
        const cargarVoces = () => {
            const voces = speechSynthesis.getVoices();
            const vozEspa√±ol = voces.find(v => v.lang.includes("es"));
            if (vozEspa√±ol) {
                voz.voice = vozEspa√±ol;
            }
        };
        
        if (speechSynthesis.getVoices().length === 0) {
            speechSynthesis.onvoiceschanged = cargarVoces;
        } else {
            cargarVoces();
        }
        
        voz.onend = () => {
            parteIndex++;
            setTimeout(hablarParte, 100); // Peque√±a pausa entre partes
        };
        
        voz.onerror = (evento) => {
            console.error("Error en s√≠ntesis de voz:", evento);
            parteIndex++;
            setTimeout(hablarParte, 100);
        };
        
        speechSynthesis.speak(voz);
    }
    
    // Comenzar a hablar
    hablarParte();
}

function dividirTextoEnPartes(texto, maxCaracteres) {
    const partes = [];
    const palabras = texto.split(' ');
    let parteActual = '';
    
    for (let palabra of palabras) {
        if ((parteActual + ' ' + palabra).length <= maxCaracteres) {
            parteActual += (parteActual ? ' ' : '') + palabra;
        } else {
            if (parteActual) partes.push(parteActual);
            parteActual = palabra;
        }
    }
    
    if (parteActual) partes.push(parteActual);
    return partes;
}

/* ---------------------------------------------------
    RECONOCIMIENTO DE VOZ (CORREGIDO)
-----------------------------------------------------*/
function solicitarPermisoMicrofono() {
    permissionNotification.style.display = 'block';
    
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        return navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                permissionNotification.style.display = 'none';
                // Detener las pistas para liberar el micr√≥fono
                stream.getTracks().forEach(track => track.stop());
                return true;
            })
            .catch(error => {
                permissionNotification.style.display = 'none';
                console.error("Error de micr√≥fono:", error);
                agregarMensajeBot("‚ùå Necesitas permitir el acceso al micr√≥fono para hablar.");
                return false;
            });
    }
    return Promise.resolve(false);
}

function iniciarReconocimientoVoz() {
    if (escuchando) {
        detenerReconocimientoVoz();
        return;
    }
    
    if (botHablando || mensajeEnProceso) {
        agregarMensajeBot("‚åõ Espera a que termine de hablar o procesar...");
        return;
    }
    
    solicitarPermisoMicrofono().then(permisoConcedido => {
        if (!permisoConcedido) return;
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        if (!SpeechRecognition) {
            agregarMensajeBot("‚ö†Ô∏è Tu navegador no soporta reconocimiento de voz. Usa Chrome o Edge.");
            return;
        }
        
        reconocimiento = new SpeechRecognition();
        
        // CONFIGURACI√ìN MEJORADA
        reconocimiento.lang = "es-ES";
        reconocimiento.continuous = false;  // Se detiene autom√°ticamente
        reconocimiento.interimResults = false;  // Solo resultados finales
        reconocimiento.maxAlternatives = 1;
        
        // MEJORA: Aumentar tiempo de espera
        reconocimiento.onspeechstart = () => {
            console.log("Comenz√≥ a detectar voz");
        };
        
        reconocimiento.onspeechend = () => {
            console.log("Detuvo detecci√≥n de voz");
            // No detener inmediatamente, esperar resultado
        };
        
        reconocimiento.onstart = () => {
            console.log("Reconocimiento iniciado");
            escuchando = true;
            micBtn.classList.add("recording");
            micBtn.style.display = "none";
            stopBtn.style.display = "flex";
            
            agregarMensajeBot("üé§ <b>Escuchando...</b> Di algo claro y fuerte.");
        };
        
        reconocimiento.onresult = (evento) => {
            console.log("Resultado recibido");
            if (evento.results.length > 0) {
                const texto = evento.results[0][0].transcript;
                console.log("Texto reconocido:", texto);
                
                if (texto.trim().length > 0) {
                    // Poner texto en input y enviar
                    messageInput.value = texto;
                    setTimeout(() => sendMessage(), 100);
                } else {
                    agregarMensajeBot("No escuch√© nada claro. Intenta de nuevo.");
                }
            }
        };
        
        reconocimiento.onend = () => {
            console.log("Reconocimiento finalizado");
            escuchando = false;
            micBtn.classList.remove("recording");
            micBtn.style.display = "flex";
            stopBtn.style.display = "none";
        };
        
        reconocimiento.onerror = (evento) => {
            console.error("Error de reconocimiento:", evento.error);
            escuchando = false;
            micBtn.classList.remove("recording");
            micBtn.style.display = "flex";
            stopBtn.style.display = "none";
            
            if (evento.error === "not-allowed" || evento.error === "permission-denied") {
                agregarMensajeBot("‚ùå Permiso de micr√≥fono denegado. Haz clic en üé§ para volver a intentar.");
            } else if (evento.error === "no-speech") {
                agregarMensajeBot("üé§ No detect√© voz. Haz clic en üé§ para intentar de nuevo.");
            } else if (evento.error === "audio-capture") {
                agregarMensajeBot("üé§ No se pudo acceder al micr√≥fono. Verifica que est√© conectado.");
            } else {
                agregarMensajeBot("‚ö†Ô∏è Error con el micr√≥fono: " + evento.error);
            }
        };
        
        try {
            reconocimiento.start();
            console.log("Reconocimiento iniciado correctamente");
        } catch (error) {
            console.error("Error al iniciar reconocimiento:", error);
            agregarMensajeBot("Error al iniciar el micr√≥fono. Recarga la p√°gina.");
        }
    });
}

function detenerReconocimientoVoz() {
    if (reconocimiento && escuchando) {
        reconocimiento.stop();
    }
    escuchando = false;
    micBtn.classList.remove("recording");
    micBtn.style.display = "flex";
    stopBtn.style.display = "none";
}

/* ---------------------------------------------------
    MANEJO DE ENTRADA DEL USUARIO
-----------------------------------------------------*/
function bloquearEntradaUsuario(bloquear) {
    messageInput.disabled = bloquear;
    sendBtn.disabled = bloquear;
    micBtn.disabled = bloquear;
    
    if (bloquear) {
        messageInput.placeholder = "Espera...";
    } else {
        messageInput.placeholder = "Escribe tu mensaje aqu√≠...";
        messageInput.focus();
    }
}

/* ---------------------------------------------------
    ONDAS DE AUDIO - FUNCIONALES
-----------------------------------------------------*/
function agregarOndasAudio() {
    // Buscar el √∫ltimo mensaje del bot
    const mensajesBot = document.querySelectorAll('.msg.bot');
    if (mensajesBot.length === 0) return;
    
    const ultimoMensaje = mensajesBot[mensajesBot.length - 1];
    
    // Limpiar ondas anteriores
    const ondasAnteriores = ultimoMensaje.querySelector('.audio-waves');
    if (ondasAnteriores) ondasAnteriores.remove();
    
    // Crear elemento de ondas VISIBLE
    const ondas = document.createElement('div');
    ondas.className = 'audio-waves';
    ondas.id = 'audioWaves';
    
    // Crear 7 barras de onda
    for (let i = 0; i < 7; i++) {
        const barra = document.createElement('div');
        barra.className = 'wave-bar';
        ondas.appendChild(barra);
    }
    
    ultimoMensaje.appendChild(ondas);
    
    // Hacer scroll para que sea visible
    chatElement.scrollTop = chatElement.scrollHeight;
}

function removerOndasAudio() {
    const ondas = document.getElementById('audioWaves');
    if (ondas) {
        ondas.remove();
    }
    
    // Tambi√©n limpiar cualquier intervalo
    if (audioWavesInterval) {
        clearInterval(audioWavesInterval);
        audioWavesInterval = null;
    }
}

/* ---------------------------------------------------
    EVENTOS PRINCIPALES
-----------------------------------------------------*/
document.addEventListener('DOMContentLoaded', () => {
    // Mensaje inicial
    setTimeout(() => {
        agregarMensajeBot(`
            <b>¬°Hola! üëã Soy tu Asistente Virtual.</b><br>
            <b>Para hablar conmigo:</b><br>
            1. Haz clic en <b>üé§ Hablar</b> y PERMITE el micr√≥fono<br>
            2. Habla claro cuando veas "Escuchando..."<br>
            3. O escribe en el cuadro de texto<br><br>
            <i>Primera vez? Haz clic en üé§ y ALLOW/PERMITIR cuando el navegador pregunte</i>
        `);
    }, 500);
    
    // Verificar conexi√≥n inicial
    actualizarEstadoConexion();
});

// Eventos de teclado
messageInput.addEventListener("keypress", e => {
    if (e.key === "Enter" && !mensajeEnProceso && !botHablando) {
        sendMessage();
    }
});

sendBtn.addEventListener("click", sendMessage);

micBtn.addEventListener("click", iniciarReconocimientoVoz);
stopBtn.addEventListener("click", detenerReconocimientoVoz);

// Eventos de conexi√≥n
window.addEventListener('online', actualizarEstadoConexion);
window.addEventListener('offline', actualizarEstadoConexion);

// Pausar voz al hacer clic en cualquier parte
document.addEventListener('click', () => {
    if (botHablando) {
        speechSynthesis.cancel();
        botHablando = false;
        bloquearEntradaUsuario(false);
        removerOndasAudio();
    }
});

/* ---------------------------------------------------
    ENVIAR MENSAJE AL SERVIDOR
-----------------------------------------------------*/
async function sendMessage() {
    const message = messageInput.value.trim();
    
    if (!message) {
        if (!escuchando) {
            agregarMensajeBot("Escribe algo o haz clic en üé§ para hablar conmigo.");
        }
        return;
    }
    
    if (mensajeEnProceso || botHablando) {
        agregarMensajeBot("‚åõ Por favor espera, estoy procesando...");
        return;
    }
    
    // Agregar mensaje del usuario
    agregarMensajeUsuario(message);
    messageInput.value = "";
    mensajeEnProceso = true;
    bloquearEntradaUsuario(true);
    mostrarProcesando(true);
    
    try {
        const response = await fetch(N8N_WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                message, 
                sessionId,
                timestamp: new Date().toISOString()
            })
        });

        if (!response.ok) {
            throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        const respuesta = data.output || data.message || data.reply || "No entend√≠ eso. ¬øPuedes reformular?";
        
        // Agregar respuesta del bot
        agregarMensajeBot(respuesta);
        
        // Hablar la respuesta (dividida en partes si es larga)
        hablarGratis(respuesta);

    } catch (error) {
        console.error("Error:", error);
        
        let mensajeError = "‚ö†Ô∏è Error de conexi√≥n con el servidor.";
        
        if (!navigator.onLine) {
            mensajeError = "üåê Sin conexi√≥n a internet. Con√©ctate e intenta de nuevo.";
        } else if (error.message.includes("Failed to fetch")) {
            mensajeError = "üîå No puedo contactar al servidor. Revisa tu conexi√≥n.";
        }
        
        agregarMensajeBot(mensajeError);
        
        // Desbloquear entrada despu√©s de error
        setTimeout(() => {
            if (!botHablando) {
                bloquearEntradaUsuario(false);
            }
        }, 2000);
        
    } finally {
        mensajeEnProceso = false;
        mostrarProcesando(false);
    }
}

/* ---------------------------------------------------
    MANEJO DE MENSAJES EN EL CHAT
-----------------------------------------------------*/
function agregarMensajeUsuario(msg) {
    const burbuja = document.createElement("div");
    burbuja.className = "msg user";
    burbuja.textContent = msg;
    chatElement.appendChild(burbuja);
    chatElement.scrollTop = chatElement.scrollHeight;
    
    // Guardar en historial
    guardarEnHistorial("usuario", msg);
}

function agregarMensajeBot(msgHTML) {
    const burbuja = document.createElement("div");
    burbuja.className = "msg bot";
    burbuja.innerHTML = msgHTML;
    chatElement.appendChild(burbuja);
    chatElement.scrollTop = chatElement.scrollHeight;
    
    // Guardar en historial
    guardarEnHistorial("bot", msgHTML);
}

/* ---------------------------------------------------
    FUNCIONES AUXILIARES
-----------------------------------------------------*/
function mostrarProcesando(show) {
    loader.style.display = show ? "block" : "none";
}

function actualizarEstadoConexion() {
    if (navigator.onLine) {
        connectionStatus.innerHTML = "üü¢ Conectado";
        connectionStatus.style.background = "rgba(40, 167, 69, 0.2)";
        connectionStatus.style.color = "#28a745";
    } else {
        connectionStatus.innerHTML = "üî¥ Sin conexi√≥n";
        connectionStatus.style.background = "rgba(220, 53, 69, 0.2)";
        connectionStatus.style.color = "#dc3545";
        
        if (mensajeEnProceso) {
            agregarMensajeBot("‚ö†Ô∏è Se perdi√≥ la conexi√≥n. Reintentando...");
        }
    }
}

function guardarEnHistorial(tipo, contenido) {
    try {
        const historial = JSON.parse(localStorage.getItem("chatHistorial") || "[]");
        historial.push({
            tipo,
            contenido,
            fecha: new Date().toISOString()
        });
        
        // Limitar a √∫ltimos 100 mensajes
        if (historial.length > 100) {
            historial.splice(0, historial.length - 100);
        }
        
        localStorage.setItem("chatHistorial", JSON.stringify(historial));
    } catch (error) {
        console.error("Error guardando historial:", error);
    }
}

/* ---------------------------------------------------
    REINICIAR CHAT
-----------------------------------------------------*/
document.getElementById("refreshChat").addEventListener("click", () => {
    if (chatElement.children.length === 0 || 
        confirm("¬øSeguro que quieres reiniciar la conversaci√≥n? Se perder√°n todos los mensajes.")) {
        
        // Detener voz y reconocimiento
        if (botHablando) {
            speechSynthesis.cancel();
        }
        detenerReconocimientoVoz();
        
        // Limpiar chat
        chatElement.innerHTML = "";
        
        // Nueva sesi√≥n
        sessionId = crypto.randomUUID();
        localStorage.setItem("sessionId", sessionId);
        
        // Reiniciar estados
        botHablando = false;
        mensajeEnProceso = false;
        
        // Desbloquear entrada
        bloquearEntradaUsuario(false);
        
        // Mensaje inicial
        setTimeout(() => {
            agregarMensajeBot(`
                <b>¬°Conversaci√≥n reiniciada! üîÑ</b><br>
                Haz clic en <b>üé§ Hablar</b> para hablar conmigo o escribe abajo.
            `);
        }, 300);
    }
});

/* ---------------------------------------------------
    MANEJO DE CIERRE DE PESTA√ëA
-----------------------------------------------------*/
window.addEventListener('beforeunload', () => {
    if (botHablando) {
        speechSynthesis.cancel();
    }
    detenerReconocimientoVoz();
});
</script>

</body>
</html>
